import urllib.request
import cv2
import numpy as np
import matplotlib.pyplot as plt

def pokaz_histogramy(url):
    print(f"Pobieranie obrazu z: {url}")
    
    req = urllib.request.Request(url, headers={'User-Agent': 'Mozilla/5.0'})
    try:
        with urllib.request.urlopen(req) as response:
            arr = np.asarray(bytearray(response.read()), dtype=np.uint8)
            img_bgr = cv2.imdecode(arr, cv2.IMREAD_COLOR)
            
            if img_bgr is None:
                print("Błąd: Nie udało się wczytać obrazu.")
                return
    except Exception as e:
        print(f"Błąd pobierania: {e}")
        return

    img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
    img_gray = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2GRAY)

    plt.figure(figsize=(15, 5))

    plt.subplot(1, 3, 1)
    plt.imshow(img_rgb)
    plt.title("Oryginalne Zdjęcie")
    plt.axis('off')

    plt.subplot(1, 3, 2)
    hist_gray = cv2.calcHist([img_gray], [0], None, [256], [0, 256])
    
    plt.plot(hist_gray, color='black')
    plt.title("Histogram Globalny (Jasność)")
    plt.xlabel("Jasność (0=Czerń, 255=Biel)")
    plt.ylabel("Liczba pikseli")
    plt.grid(alpha=0.3)
    plt.xlim([0, 256])
    # Wypełnienie pod wykresem dla lepszego efektu
    plt.fill_between(range(256), hist_gray.ravel(), color='gray', alpha=0.3)

    plt.subplot(1, 3, 3)
    
    colors = ('r', 'g', 'b') # Kolejność kanałów w img_rgb
    labels = ('Red (Czerwony)', 'Green (Zielony)', 'Blue (Niebieski)')
    
    for i, color in enumerate(colors):
        # Obliczamy histogram dla kanału i (0, 1 lub 2)
        hist = cv2.calcHist([img_rgb], [i], None, [256], [0, 256])
        plt.plot(hist, color=color, label=labels[i])
        plt.xlim([0, 256])

    plt.title("Histogramy Kanałów RGB")
    plt.xlabel("Intensywność koloru")
    plt.ylabel("Liczba pikseli")
    plt.legend()
    plt.grid(alpha=0.3)

    plt.tight_layout()
    plt.show()


url = "https://commons.wikimedia.org/wiki/Category:Fjordlandscapes#/media/File:Blick_von_Urnes_nach_Solvorn_18.07.08_3.jpg"

pokaz_histogramy(url)
